<!DOCTYPE html>
<html>
<head>
    <title>Progetto</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <div class="container-fluid">
        <div class="col-md-6">
            <h1>Ottimizzazione</h1>
            <label>File di input</label>
            <select name="inputFile" id="inputFile">
                <option value="trivial.json">Trivial</option>
                <option value="toy.json">Toy</option>
                <option value="elba.json">Elba</option>
                <option value="gap1_0.json">Gap1_0</option>
                <option value="gapa_0.json">GapA_0</option>
                <option value="gapd_0.json">GapD_0</option>
            </select>

            <label>Metodo di calcolo del costo</label>
            <select name="computationMethod" id="computationMethod">
                <option value="resolveRandomGAPInstance">Random</option>
                <option value="resolveConstructiveGAPInstance">Constructive</option>
                <option value="resolveOpt1_0GAPInstance">Opt1_0</option>
                <option value="resolveSimulatedAnnealingGAPInstance">Simulated Annealing</option>
                <option value="resolveTabuSearchGAPInstance">Tabu Search</option>
            </select>
            <div id="SAParams" style="display:none">
                <div>
                    <label> Temperatura(SA only)</label>
                    <input type="text" id="temp" />
                </div>

                <div>
                    <label> Passi totali da eseguire(SA only)</label>
                    <input type="text" id="totalSteps" />
                </div>

                <div>
                    <label> Costante di decremento della temperatura(SA only)</label>
                    <input type="text" id="decreaseTemperature" />
                </div>

                <div>
                    <label> Passi dopo cui cala la temperatura(SA only)</label>
                    <input type="text" id="decreaseSteps" />
                </div>
            </div>

            <div id="TabuPar" style="display:none">
                <div>
                    <label> Tabu Tenure</label>
                    <input type="text" id="tabuTenure" />
                </div>

                <div>
                    <label> Passi totali da eseguire</label>
                    <input type="text" id="totalStepsT" />
                </div>
            </div>
            <input type="button" value="Compute!" onclick="computeHeu();" />

        </div>
        <div class="col-md-6">
            <h1>Previsione</h1>
            <h1>Mettere in path di sistema variabile con stesso nome di R</h1>
            <label>Tabella da leggere</label>
            <select name="tableName" id="tableName">
                <option value="clienti">Clienti</option>
                <option value="ordini">Ordini</option>
                <option value="serie">Serie</option>
            </select>
            <input type="button" value="Read table!" onclick="readTable();" />
            <input type="button" value="Launch statistics!" onclick="launchStat();" />

        </div>
    </div>
  
    <script>

        $(document).ready(function () {
            $('#computationMethod').on('change', function () {

                if (this.value == 'resolveTabuSearchGAPInstance') {
                    $("#TabuPar").show();
                }
                else {
                    $("#TabuPar").hide();
                }

                if (this.value == 'resolveSimulatedAnnealingGAPInstance') {
                    $("#SAParams").show();
                }
                else {
                    $("#SAParams").hide();
                }
            });
        });

        function launchStat() {
            $.ajax({
                url: "api/Database/prevision",
                type: "GET",
                contentType: "application/json",
                success: function (result) {
                    alert(result)
                },
                error: function (xhr, status, p3, p4) {
                    var err = "Error " + " " + status + " " + p3;
                    if (xhr.responseText && xhr.responseText[0] == "{")
                        err = JSON.parse(xhr.responseText).message;
                    alert(err);
                }
            });
        }


        function readTable() {

           
                $.ajax({
                    url: "api/Database/readDB?dbToRead=" + document.getElementById("tableName").value,
                    type: "GET",
                    contentType: "application/json",
                    success: function (result) {
                        alert(result)
                    },
                    error: function (xhr, status, p3, p4) {
                        var err = "Error " + " " + status + " " + p3;
                        if (xhr.responseText && xhr.responseText[0] == "{")
                            err = JSON.parse(xhr.responseText).message;
                        alert(err);
                    }
                });
            
        }

        function postFunction() {
            var cacio = "clienti"
            var options = {};
            options.url = "/api/Database/insertCustomer";
            options.type = "POST";
            options.data = JSON.stringify({
                "tableId": cacio
            });
            options.dataType = "json";
            options.contentType = "application/json";
            options.success = function (msg) {
                alert(msg);
            };
            options.error = function (err) { alert(err.statusText); };
            $.ajax(options);
        }
          
            function computeHeu() {
                var fileComboBox = document.getElementById("inputFile");
                var file = fileComboBox.options[fileComboBox.selectedIndex].value;
                var pathComboBox = document.getElementById("computationMethod");
                var path = pathComboBox.options[pathComboBox.selectedIndex].value;
                var options = {};
                options.url = "/api/Heuristics/" + path;
                options.type = "POST";
                options.contentType = "application/json";
                if (path == "resolveSimulatedAnnealingGAPInstance") {
                    options.data = JSON.stringify({
                        "fileName": file,
                        "temperature": document.getElementById("temp").value,
                        "steps": document.getElementById("totalSteps").value,
                        "tempDecrease": document.getElementById("decreaseTemperature").value,
                        "cooling_schedule_steps": document.getElementById("decreaseSteps").value
                    });
                } else {
                    options.data = "\"" + file + "\""
                }
                if (path == "resolveTabuSearchGAPInstance") {
                    options.data = JSON.stringify({
                        "fileName": file,
                        "queueSize": document.getElementById("tabuTenure").value,
                        "maxSteps": document.getElementById("totalStepsT").value
                    });
                }
                options.success = function (msg) {
                    displayCost(msg);
                };
                options.error = function (err) { alert(err.statusText); };
                $.ajax(options);
            }

            function displayCost(cost) {
                alert("Cost of the solution is: " + cost)
            }

    </script>
</body>
</html>
